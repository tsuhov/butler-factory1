name: üõ†Ô∏è One-Time Surgeon (Repair Existing Posts)

# –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –µ–≥–æ –≤—Ä—É—á–Ω—É—é
on:
  workflow_dispatch:

jobs:
  repair-posts:
    permissions:
      contents: write
      
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: üì¶ Install dependencies (including gray-matter)
        run: npm install

      - name: ü©∫ Run the Surgeon Script
        run: npm run surgeon

      - name: üöÄ Commit and Push Repaired Files
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions-bot@github.com'
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
          if [[ -z $(git status --porcelain) ]]; then
            echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ —Ñ–∞–π–ª—ã —É–∂–µ –±—ã–ª–∏ –≤ –ø–æ—Ä—è–¥–∫–µ."
            exit 0
          fi

          echo "üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏ –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ñ–∞–π–ª—ã. –ü—É–±–ª–∏–∫—É—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
          git add src/content/posts/*.md
          git commit -m "ü©∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç (–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ frontmatter) —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç–µ–π"
          git pull --rebase
          git push```
